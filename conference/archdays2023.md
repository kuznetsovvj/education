# ArchDays 2023

1. Руслан Сафин - "Раз архитектура as Code, почему бы не покрыть её тестами?" 

[Презентация](https://drive.google.com/file/d/1Ma_WxjT73rwoDCaEE0F0iEapTLknYrIN/view)

При хранении архитектурных артефактов в виде plantuml диаграмм, полезно покрыть их тестами. Тестами можно проверять актуальность (соответствие реальности) и соответствие принципам. Информацию о реальности можно брать из данных по траффику (минусы: нет редких связей, сложно воспроизвести на тестовых средах, долгая обратная связь) или из конфигов k8s.

![Принцип построения тестов](/conference/images/archdays23-01-test-principes.png)

Тесты для проверки принципов:

- Anti-corruption layer. За внешние интеграции отвечают специальные сервисы-адаптеры. Как протестировать? Контейнерам на схеме присваивать нужный тег. Пример: `Container(good_adapter, "Goods ACL", "Java", $tags="adapter")`, если у сервиса есть связь с внешним сервисом и нет тега, то тест должен упасть.
- Пассивные репозитории. Исходящие связи должны быть только в базы данных. Помечать сервисы-репозитории специальным тегом.
- Внешние HTTP-вызовы должны идти через API-gateway
- Операции записи идут только через оркестратор, для реализации распределенных транзацкий.



