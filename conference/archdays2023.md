# ArchDays 2023

## Руслан Сафин - "Раз архитектура as Code, почему бы не покрыть её тестами?" 

[Презентация](https://drive.google.com/file/d/1Ma_WxjT73rwoDCaEE0F0iEapTLknYrIN/view)

При хранении архитектурных артефактов в виде plantuml диаграмм, полезно покрыть их тестами. Тестами можно проверять актуальность (соответствие реальности) и соответствие принципам. Информацию о реальности можно брать из данных по траффику (минусы: нет редких связей, сложно воспроизвести на тестовых средах, долгая обратная связь) или из конфигов k8s (но конфиги должны быть оформлены в единообразном стиле).

![Принцип построения тестов](/conference/images/archdays23-01-test-principes.png)

Тесты для проверки принципов:

- Anti-corruption layer. За внешние интеграции отвечают специальные сервисы-адаптеры. Как протестировать? Контейнерам на схеме присваивать нужный тег. Пример: `Container(good_adapter, "Goods ACL", "Java", $tags="adapter")`, если у сервиса есть связь с внешним сервисом и нет тега, то тест должен упасть.
- Пассивные репозитории. Исходящие связи должны быть только в базы данных. Помечать сервисы-репозитории специальным тегом.
- Внешние HTTP-вызовы должны идти через API-gateway
- Операции записи идут только через оркестратор, для реализации распределенных транзацкий.

## Константин Крючков - "Безопасная разработка при использовании компонентов с открытым кодом"

[Презентация](https://drive.google.com/file/d/1u3CE-3k0_51pxsr7B4NCCE7HAAwlKnsx/view)

Материалы для изучения:

- [ ] [SPDX](https://spdx.org/licenses/) - список лицензий и их условий
- [ ] SBOM (Software Bill of Materials)-файл формата CycloneDX. Что это за формат? Что полезного может дать SBOM-файл?

## Сергей Баранов - "Сколько займет проведение Event Storming?"

[Презентация](https://drive.google.com/file/d/1Hj2zz7PMSr8rvjWjKagoj4btzkW174kw/view)

C чего начать EventStorming: постановка цели, определение скоупа, определение критериев успешности сессии, формирования состава участников, календарное планирование. 

Если домен для исследования слишком сложный, то для начала стоит понять, откуда возникает сложность (количество событий, сущностей, взаимодействий, акторов (действующих лиц)). Бороться со сложностью можно сокращением скоупа (более четкой постановкой цели) и управление гранулярности (детализацией). Антипаттерны управления детализацией: блуждание в трех соснах (исследование не относящихся к делу деталей), перегрузка информацией (чрезмерное объяснение), капитанство (объяснение очевидное, не раскрывая внутренней сложности).

Подготовка к Event Storming включает: карту заинтересованных лиц, перечень основных бизнес-процессов (единообразие названий в разных отделах/исполнителях), перечень опорных событий (основные этапы жизненного цикла, задает первичную структуру). 

## Роман Пионтик, Валентин Козлов - "Опыт использования подхода "Архитектура как код" в ГК "Самолет"

[Презентация](https://drive.google.com/file/d/1uL1K414maSw-9Tvx7l3A1lzhX2o4_O-f/view?usp=drive_link)

Опыт использования инструментов:

- [Structurizr](https://structurizr.com/) - проблемы с покупкой лицензии, мета-модель нельзя расширять, нельзя поддерживать консистентность данных ("управление картинками")
- PlantUML + плагин C4 - широкое коммьюнити, хорош для рисования простых схем; нечитаемость больших схем, "управление картинками"
- DocHub - функционал аналогичен PlantUML, можно расширять модель, open-source, растущее коммьюнити 

Материалы для изучения:

- [ ] [dochub](https://dochub.info/) как инструмент для документирования архитектуры

## Максим Юнусов - "Простая архитектурная задача и немного ТРИЗ"

[Презентация](https://drive.google.com/file/d/1Wvw-rteyDoRhnCLdTd7Gm0CbeHgaayqX/view)

Обзорный доклад начального уровня про подходы к решению архитектурных задач в IT. Может быть полезен, чтобы пояснить ценность профессии "архитектор" или указания путей развития разработка в архитектора.

## [Андрей Кузнецов - Аутентификация для WebSocket](https://www.youtube.com/watch?v=coinSGTsge0)

[Презентация](https://drive.google.com/file/d/1Jl3lpViRozB-CyQBR1TaTcq40IDfIMy6)

[RFC 6455 WebSocker Protocol](https://datatracker.ietf.org/doc/html/rfc6455)

Особенности установления соединения: после HTTP handshake идет обмен специальными запросами HTTP Upgrade, после чего устанавливается соединение websocket, сообщения в котором могут отправляться с любой стороны без заголовков HTTP.

Специфика работы с WS в браузере: нет возможности в первом HTTP запросе передать заголовки.

Варианты аутентификации для WSS:

- WS-заголовок "Sec-WebSocket-Protocol" (не рекомендуется) - предназначен для указания протокола собощений внутри WS-соединения
- блок userinfo URL (не рекомендуется) - не поддерживается новыми версиями браузеров
- кастомные заголовки WS (не рекомендуется) - не поддерживается браузерами
- TLS-сертификаты (не рекомендуется) - не распространены у клиентов
- Передача токена авторизации в каждом сообщении - безусловное установление соединения, рост траффика, повышение latency ответов (из-за разбора токена), потенциальная опасность DDoS-атак
- Передача токена в первом сообщении при установлении соединения - безусловное установление соединение, ожидание первого сообщения (сложная система состояний на стороне сервера), вероятность DoS-атак
- query-params в URL - TLS не шифрует query-params, может быть сохранен в логах и истории браузера. Недостаток невелируется при использовании одноразового короткоживущего токена для конкретного соединения (не сессионного токена пользователя)
- cookies - нельзя разделить хост сайта и ws-API без отключения безопасной настройки host-only. Потенциальная возможность кросс-сайтовых атак.